import unittest
import numpy as np

from sample_data import SampleData
from technical_indicators import money_flow_index


class TestMoneyFlow(unittest.TestCase):
    def setUp(self):
        """Create data to use for testing."""
        self.close_data = SampleData().get_sample_close_data()
        self.high_data = SampleData().get_sample_high_data()
        self.low_data = SampleData().get_sample_low_data()
        self.volume = SampleData().get_sample_volume()

        self.mfi_period_6_expected =[np.nan, np.nan, np.nan, np.nan, np.nan,
        np.nan, 74.06314264213654, 74.183747444400751, 59.316211161011942,
        46.452795494965628, 69.414050550304594, 68.465048794439653,
        48.661796288014102, 30.354104727339575, 50.77291641718773,
        51.313514188741571, 34.540748631225568, 19.35511730610466,
        34.306535338349676, 35.055747174938816, 38.534393298873475,
        55.112759816224063, 68.986562909590603, 66.327177256131932,
        50.827713006061543, 50.973605857497937, 47.60544002605414,
        48.380606792094966, 35.334406074032032, 52.911963193935264,
        53.061969232630126, 52.581880469258159, 35.674293506332234,
        32.995662535268252, 48.204314454691456, 50.198706732467734,
        67.06721588536125, 64.738179531451522, 62.321775126489264,
        43.78957641398506, 47.665861110039785, 55.529312448674915,
        62.868798601978391, 76.613038566253564, 76.574444855884366,
        89.482214713452422, 89.828164302416639, 88.358800092125563,
        76.418931637137575, 59.091738620757937, 76.496841685458691,
        60.425298770260881, 36.66519577536662, 19.194081086355126,
        34.420548310525362, 50.27611550599314, 30.042618865627801,
        45.463273752174899, 44.664872407207106, 62.330184090936783,
        47.025824978278159, 45.070129290830693, 49.266532197228969,
        47.004376391430881, 51.704302665673801, 45.935249794192913,
        70.043726919418901, 52.284664799981215, 70.249981056374963,
        76.037459462436686, 67.852966315691788, 52.374977842773554,
        35.761061048729971, 49.068784449177421, 51.766797364049324,
        32.337117733143089, 31.748797559336296, 47.622895363576063,
        49.620065985772733, 49.976640169117111, 54.20377462333505,
        69.923314041024298, 72.451359631771112, 54.118485465694796,
        59.144965617853082, 57.703404643220324, 51.189333987717987,
        29.593208682276966, 28.909269245739694, 51.057044789615752,
        63.649963773445201, 42.448464859328617, 52.353820658816637,
        69.104433247362167, 84.912115422285282, 71.220911050269763,
        71.20500578623431, 84.465864248920639, 83.044564471973786,
        68.741691500859233, 42.836050402746686, 45.342097761524045,
        47.354816336907312, 27.237264727642781, 31.526289801067279,
        43.411052455676455, 56.810916407763884, 60.387543309516929,
        47.185374643446117, 60.259203844238044, 38.786688863573694,
        19.142999603619316, 11.140866719116062, 11.65337378445976,
        27.674315156008575, 29.359488642172764, 48.933539274026501,
        54.069537732538912, 39.854764017061719, 40.087285478670047,
        38.541887074904679, 37.008898160347883, 15.581804530019255,
        15.410060107268308, 31.488703561986881, 30.276587489445419,
        31.160294806865338]

        self.mfi_period_8_expected = [np.nan, np.nan, np.nan, np.nan, np.nan,
        np.nan, np.nan, np.nan, 67.912890108967957, 60.102398727301157,
        58.558820439955319, 55.558062966736578, 65.3288508443203,
        54.056533721822447, 48.983955347130149, 36.414310006581218,
        39.734973236985141, 40.084536583992914, 37.631567309709141,
        25.340976576728991, 41.718751043625183, 55.48541009011155,
        53.671106902533857, 52.072090318385683, 50.354108699678896,
        49.573801966365892, 50.797461088977165, 63.300618547611855,
        50.467982936395089, 50.449374107590586, 39.05355698394159,
        39.30909563969437, 39.265508430661413, 50.712189201260998,
        50.849498283618267, 51.768412858892383, 62.709973038428643,
        49.269120397244087, 47.718641602149425, 44.047020693135167,
        57.41306896974379, 64.002335105406019, 69.149512378026969,
        72.165150460196443, 64.091952794743918, 72.126920394523154,
        81.335008238213632, 91.515050685389042, 85.314944472613618,
        76.91258907024023, 73.250725132888761, 57.611028037810364,
        59.134146281693241, 46.226237197635186, 39.312980896580719,
        39.689429739402605, 36.416166793334547, 47.205236754244304,
        34.217730019110292, 48.473218918875162, 47.093727827503386,
        56.746719564562461, 46.921517997795071, 44.957595593580656,
        50.364048682311555, 49.319035504492469, 63.91312101723188,
        48.078326363306651, 64.35528205079288, 69.605886098062328,
        66.025318330967849, 53.510564958575046, 48.147738474246552,
        49.927264270823272, 51.380772642799073, 50.246190014306656,
        39.693464901292863, 35.825009362336544, 36.118329706707883,
        48.208246427142328, 64.864784643470557, 66.385446237633545,
        55.489671295303829, 52.28696214814137, 57.15901534041641,
        55.946036758505464, 66.794733805524487, 55.227392371397862,
        37.891364853402521, 33.945496361418861, 47.58715792134489,
        46.23174582440442, 60.329241159022246, 65.307393133324496,
        72.222286569717369, 67.771577875988044, 75.112150402101037,
        75.603137225303527, 75.801941606008228, 78.093356175452669,
        66.526441687865486, 53.735130799211042, 44.3391177407416,
        41.43473886469225, 44.830079346040286, 44.249720107044936,
        43.980696051676404, 45.667030968107944, 47.561184781800101,
        50.368412325813459, 39.446255881987611, 45.434635861746486,
        36.977299113670405, 24.23386326598586, 20.227765543046104,
        21.339915744464491, 36.369185435773232, 36.116124072465659,
        37.34527423979052, 41.981793709410105, 42.641499426792535,
        42.202309463233313, 28.465864360076282, 26.711866944178993,
        23.509213260325566, 23.763874742141638, 35.712358359103447]

        self.mfi_period_10_expected = [np.nan, np.nan, np.nan, np.nan, np.nan,
        np.nan, np.nan, np.nan, np.nan, np.nan, 66.164205738306606,
        65.386332108988114, 57.140601250115132, 47.13444034667836,
        62.51635608530777, 54.480146130807043, 41.173200923953722,
        30.375781327464068, 41.260086060571581, 40.919118209189776,
        42.827176993423706, 43.939546447503233, 52.832738155180515,
        52.980277818910515, 41.674003162376607, 41.153424650925473,
        50.421433451656256, 60.076137141760015, 52.394732551691149,
        62.211001800307088, 50.281744555790866, 39.887929997820351,
        31.029287559599169, 40.444124692267465, 50.820220147584536,
        61.682719876355222, 62.068200277935063, 50.654938233916511,
        48.076903670536261, 36.293867048438088, 47.601703872121632,
        61.316088582211115, 72.81707114778375, 75.739369438459931,
        68.775340175014449, 68.910080160533965, 70.408948650312169,
        76.638376796409773, 78.525303911085558, 82.559675232379647,
        82.163909215694417, 73.427879225578863, 61.68482034964309,
        47.162586886803524, 57.073205110323173, 56.144082515152895,
        39.715502919174234, 39.727466299479296, 38.538664608670764,
        49.247932077799732, 38.741625347696882, 46.48012409819674,
        46.996836949811623, 54.888863057310267, 48.03971490615335,
        46.984378972721139, 60.166183347637535, 50.181551764976632,
        61.073412590814229, 63.038280964613641, 62.758854813486103,
        52.130018239824004, 49.037248289642868, 51.088518949816958,
        58.825156751901368, 50.747282022821246, 41.091373924537201,
        49.399236826228211, 41.609118918255248, 38.511246551138591,
        51.451257757288062, 61.939245808511188, 63.734034258471745,
        52.593309970642515, 46.053107489386406, 53.934096471491699,
        63.640620687062601, 54.244926810466694, 53.921222129788774,
        53.457011382302312, 50.358555504887278, 35.016729506915709,
        50.350213437997958, 65.573967661833777, 75.136454369377603,
        65.378175394036475, 65.867409853980945, 72.101588299168583,
        78.622255916996778, 71.545764802685241, 64.089355084686318,
        65.310787037382681, 63.534878550521142, 49.109281485448697,
        43.171297976913905, 52.982772299510607, 53.211259453542681,
        45.988777447683404, 38.225502035113799, 39.695705624716638,
        41.443820197343932, 41.849343630521076, 38.197113506968897,
        45.834487994052324, 39.797506632133526, 29.700676615191327,
        28.342093889112476, 28.423825510013828, 29.553384011220714,
        30.290536787493451, 39.85308969460187, 43.351732305791082,
        33.684022509639391, 32.500970620834906, 31.973390395215475,
        30.853333652881361, 28.50913239092273]

    def test_money_flow_index_period_6(self):
        period = 6
        mfi = money_flow_index.money_flow_index(self.close_data, self.high_data, self.low_data, self.volume, period)
        np.testing.assert_array_equal(mfi, self.mfi_period_6_expected)

    def test_money_flow_index_period_8(self):
        period = 8
        mfi = money_flow_index.money_flow_index(self.close_data, self.high_data, self.low_data, self.volume, period)
        np.testing.assert_array_equal(mfi, self.mfi_period_8_expected)

    def test_money_flow_index_period_10(self):
        period = 10
        mfi = money_flow_index.money_flow_index(self.close_data, self.high_data, self.low_data, self.volume, period)
        np.testing.assert_array_equal(mfi, self.mfi_period_10_expected)

    def test_money_flow_index_invalid_period(self):
        period = 128
        with self.assertRaises(Exception):
            true_range.true_range(self.close_data, period)
