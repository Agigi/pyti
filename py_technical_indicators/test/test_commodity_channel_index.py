import unittest
import numpy as np

from sample_data import SampleData
from technical_indicators import commodity_channel_index


class TestCommodityChannelIndex(unittest.TestCase):
    def setUp(self):
        """Create data to use for testing."""
        self.close_data = SampleData().get_sample_close_data()
        self.high_data = SampleData().get_sample_high_data()
        self.low_data = SampleData().get_sample_low_data()

        self.cci_period_6_expected = [np.nan, np.nan, np.nan, np.nan, np.nan,
        15.669351064084481, 13.113239655542227, 16.19055382417837,
        2.6115585106813142, -4.7240931021230006, 12.636394577158564,
        14.604766703043005, 4.5300282446419633, -18.730031102080495,
        -10.462868173364251, -50.606570120985175, -47.462719429783981,
        -77.703568935629505, -49.464359816950946, -72.430549522344222,
        -46.525663403657916, 1.142210304034798, 50.373692292007476,
        29.84163037045575, 11.660525579537541, 0.32159319239758521,
        7.5075376294310896, 3.0218670664987859, -16.19055382417837,
        14.044750971453022, -7.4132775557970696, -18.674583999943138,
        -75.829456883378512, -7.3578304536591448, 19.129250237470835,
        92.214075565038485, 96.278348151725055, 49.103953653057268,
        -34.327300933385786, -40.936595508188041, -23.315506448859818,
        35.358617033145869, 50.745187876329425, 71.621021831134698,
        45.172754111500815, 37.99235438468201, 38.607817218409352,
        45.217111793210478, -2.8111680783759172, -9.5646251187359859,
        0.53229218052045402, -17.853966888306491, -50.406960553290574,
        -43.925194313404297, -32.314571125791687, -2.6060138004671813,
        -2.173526403793745, 18.114568268352585, -21.740808748152151,
        -11.754785653170995, -19.484111691152084, -6.542758052236632,
        -11.521907824192729, 4.4191340403655452, 1.9351038646019134,
        22.467165786154208, 18.242096603269701, -8.6552926436788855,
        24.607423928665991, 20.959004608012165, -16.872553180471336,
        -27.34096606404972, -35.003755579465754, -24.174936531992557,
        -3.1660295320571654, -24.740496973795537, -21.153069465493203,
        11.416558330131577, -20.526517211338728, 25.677552999921602,
        38.918320990380373, 29.647565512973578, -14.23327111872106,
        -26.359552356213431, -29.924801023661505, -19.905509667397823,
        -0.038812971496661318, 1.6301448028450249, -3.55970395723394,
        2.0349086484494987, 9.7642346864311556, 6.5372133420230663,
        16.040846648406994, 21.202971857417563, 22.749946007056266,
        2.0515427790913301, 11.782509204239389, 9.8363159192097775,
        10.113551429897703, 6.9752454489100684, 4.4524023016497756,
        -5.0512310047347189, -1.8408437909690285, -27.479583819393401,
        -16.750569555768923, -10.207811503532291, -0.74853587885745576,
        -26.63124315668836, -87.97791696172628, -82.799157622074446,
        -71.526761757500964, -49.991107287258401, -22.433897524871963,
        -17.809609206596264, -2.0737216199455926, -9.2596660569788138,
        -6.7590017505736339, -53.362291097223739, -41.385717035503028,
        -48.970880607926873, -26.259747572366415, -28.777046009413141,
        -41.934643346665027, -58.646399930937008, -36.46201436568429,
        -38.912776280166241, -7.3190174821627672]

        self.cci_period_8_expected = [np.nan, np.nan, np.nan, np.nan, np.nan,
        np.nan, np.nan, 26.444109186973854, 8.7038088580497117,
        -2.108376058781654, 15.041412632377041, 18.763299363363025,
        7.6101147683851735, -18.9088480064738, -10.974367690583977,
        -50.900439762314932, -52.805047720741385, -92.460815169550955,
        -69.272837055607681, -93.849765078098216, -71.680627465932659,
        -21.616052768342101, 34.574040537899386, 23.275307299810191,
        11.099123670394025, 6.7784082363213969, 22.547564084254031,
        14.679620290928694, -16.904435264200334, 9.4066008776434078,
        -8.0134924364361133, -17.208008148403689, -80.621472685620674,
        -16.363826018358679, 13.785535768959893, 88.984281865523329,
        96.390628533553297, 57.242202069302294, -11.265464976806099,
        -14.837644532021271, -7.2940662862011543, 37.451745138840359,
        39.385462825889306, 63.954073783058071, 54.925899377503704,
        61.928868377482736, 65.571742987923002, 66.203839952291602,
        10.857928776095127, -1.1269623509464997, 7.3107004168424181,
        -12.255195749962454, -52.547218695801227, -56.231678632844648,
        -45.078494037866228, -11.045062745809632, -14.292876753519586,
        5.4934216442817529, -27.383937568206417, -10.54603882657114,
        -17.553166359210202, -8.9325281543673789, -16.954337656124125,
        -3.3684114548594017, -2.1624369833666135, 23.499868063467257,
        20.642956125827578, -6.1837380658953514, 29.271911395991602,
        27.296608382340061, -11.406855087256845, -26.186280162034258,
        -39.206645921495429, -25.82032928792588, -8.4168701044870549,
        -39.036146082421624, -33.393017262367927, 5.6805556139968258,
        -23.125600124038812, 24.905452102655783, 36.37052664715705,
        32.25357931344076, -5.6140190914323362, -22.181613210145652,
        -24.955354494579574, -18.206055986880106, -8.3544921145831648,
        -10.866245841415759, -11.772805961365792, 1.1643891448890604,
        12.063903247587914, 9.3109546264564234, 17.353556791514464,
        23.025795340191227, 28.423570733285995, 8.974113480970539,
        17.73198326360351, 15.910545958383945, 15.902228893062746,
        10.645843610418725, 5.8011530611462749, -2.2996685611561922,
        1.2350842001141495, -28.036827195875752, -19.669859483313058,
        -14.875071325963832, -6.0298723574633737, -32.794188559281849,
        -99.351503787701162, -95.737738905882836, -86.971552057928946,
        -72.171334319851084, -51.478475802099432, -48.525917613272206,
        -19.278957413242498, -15.216071004110315, -10.04701490733293,
        -57.961628219537538, -49.407526537260054, -58.839078610865357,
        -38.923865700593659, -45.041067243923955, -61.849856256937016,
        -75.27359968444884, -49.370099743316928, -52.584645489744638,
        -22.514295822971501]

        self.cci_period_10_expected = [np.nan, np.nan, np.nan, np.nan, np.nan,
        np.nan, np.nan, np.nan, np.nan, 6.2211648598384794, 20.190507772385079,
        21.880535445539564, 10.306507345336708, -15.932170328218044,
        -9.4748008132723651, -52.833325742831079, -56.396356526193387,
        -97.07345959637793, -78.413291842990859, -110.34416902199088,
        -92.332732363613104, -41.415658470657469, 15.157019840333657,
        7.1360420451091446, -0.22622417672096604, 2.0792663301597254,
        22.988368546248097, 20.799316953856255, -5.1199854113861099,
        18.334138792817953, -8.3969091477179916, -21.627696659791667,
        -83.992379260075637, -18.320831488305057, 9.9272491667154306,
        84.92056374985863, 97.808688170721922, 59.556841348036421,
        -9.6744103809675348, -9.2785180717055606, 9.9339028189715961,
        58.861534687231121, 54.347031631187825, 68.87860815940904,
        49.72607013904021, 59.417114650649573, 76.972776129455909,
        88.992598930843968, 34.505840602269863, 15.762502195676468,
        18.224353530585837, -5.6921995054458243, -49.150529218852128,
        -55.135489423584545, -49.832528575143961, -22.429461756700714,
        -25.147478703485778, -1.4405157135355211, -37.453408551904822,
        -21.670945399459296, -22.911851545298511, -8.8360501966475926,
        -16.214950549119536, -5.8419066812177691, -6.6104035168448556,
        18.031397615146265, 18.700089666926335, -4.857166147253114,
        31.767862698715167, 30.986058558575749, -7.2059053938014328,
        -22.319676494468599, -36.901155414613605, -26.884081942435689,
        -12.791646463144641, -41.771628866380752, -39.652440622681198,
        -6.4440622104316461, -33.26826128255901, 20.333561295899724,
        36.15261953575672, 33.7739388540531, -6.6902473439228105,
        -21.028867956704453, -19.648235113479526, -16.201643244606068,
        -5.3661705448772734, -10.017073472178485, -18.946274800417498,
        -8.9791037201628043, 5.9284041605518896, 9.2552302888081304,
        19.950976291150081, 26.431633588992621, 31.04261460275514,
        11.574028100202854, 22.961753937222301, 22.382886190905854,
        21.561160137226043, 16.228257853631867, 10.875394613268057,
        0.72192126983166005, 2.2722222455981629, -26.674491896354851,
        -18.706743319183065, -16.371311377147077, -8.9657964156493399,
        -37.586481597034371, -107.40325472461207, -106.5615677141632,
        -101.48815786857337, -87.275956648664817, -67.398170532335683,
        -68.971759291000183, -44.163616852596412, -40.420937458309133,
        -24.485440303963578, -64.643558498139157, -55.311811208381997,
        -65.741411120464292, -48.235652033581744, -55.365040426433588,
        -74.989987757015399, -92.212966622995893, -68.845339898126795,
        -68.848666724255452, -34.991557216995169]

    def test_cci_period_6(self):
        period = 6
        cci = commodity_channel_index.commodity_channel_index(self.close_data, self.high_data, self.low_data, period)
        np.testing.assert_array_equal(cci, self.cci_period_6_expected)

    def test_cci_period_8(self):
        period = 8
        cci = commodity_channel_index.commodity_channel_index(self.close_data, self.high_data, self.low_data, period)
        np.testing.assert_array_equal(cci, self.cci_period_8_expected)

    def test_cci_period_10(self):
        period = 10
        cci = commodity_channel_index.commodity_channel_index(self.close_data, self.high_data, self.low_data, period)
        np.testing.assert_array_equal(cci, self.cci_period_10_expected)

    def test_money_flow_invalid_period(self):
        period = 128
        with self.assertRaises(Exception):
            commodity_channel_index.commodity_channel_index(self.close_data, self.high_data, self.low_data, period)
