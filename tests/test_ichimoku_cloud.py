import unittest
import numpy as np

from sample_data import SampleData
from py_technical_indicators import ichimoku_cloud


class TestIchimokuCloud(unittest.TestCase):
    def setUp(self):
        """Create data to use for testing."""
        self.close_data = SampleData().get_sample_close_data()
        self.high_data = SampleData().get_sample_high_data()
        self.low_data = SampleData().get_sample_low_data()
        self.volume = SampleData().get_sample_volume()

        self.tenkansen_default_expected = [np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, 11.375, 6.160000000000025, 5.5399999999999636, 5.0450000000000159, 5.0450000000000159, 4.9950000000000045, 4.9950000000000045, 11.360000000000014, 13.20999999999998, 20.855000000000018, 20.855000000000018, 26.714999999999975, 25.504999999999995, 22.560000000000002, 22.560000000000002, 15.419999999999959, 13.569999999999993, 12.555000000000007, 12.555000000000007, 12.555000000000007, 12.555000000000007, 6.7800000000000296, 6.7350000000000136, 5.5, 16.46999999999997, 16.46999999999997, 16.46999999999997, 26.185000000000002, 29.379999999999995, 29.379999999999995, 29.379999999999995, 29.379999999999995, 29.379999999999995, 20.115000000000009, 15.845000000000027, 19.229999999999961, 19.229999999999961, 20.5, 23.724999999999966, 26.774999999999977, 23.660000000000025, 15.129999999999995, 12.920000000000016, 9.1949999999999932, 14.449999999999989, 15.569999999999993, 15.829999999999984, 15.829999999999984, 11.504999999999995, 11.504999999999995, 13.189999999999998, 10.389999999999986, 6.7299999999999613, 6.7299999999999613, 6.8949999999999818, 6.8949999999999818, 6.8949999999999818, 6.8949999999999818, 5.1750000000000114, 5.1750000000000114, 7.2900000000000205, 7.785000000000025, 7.785000000000025, 8.0850000000000364, 10.28000000000003, 10.28000000000003, 10.28000000000003, 12.745000000000005, 13.615000000000009, 13.615000000000009, 8.2749999999999773, 7.1800000000000068, 9.7549999999999955, 9.7699999999999818, 9.7699999999999818, 9.7699999999999818, 9.7699999999999818, 9.7699999999999818, 9.7699999999999818, 9.0849999999999795, 9.0849999999999795, 9.0849999999999795, 3.5099999999999909, 3.5500000000000114, 4.8999999999999773, 5.7250000000000227, 7.0600000000000023, 7.0600000000000023, 7.3300000000000409, 6.7249999999999659, 5.8050000000000068, 5.7699999999999818, 4.4200000000000159, 3.6499999999999773, 3.6499999999999773, 5.6200000000000045, 5.6200000000000045, 5.6200000000000045, 5.6200000000000045, 8.5749999999999886, 20.819999999999993, 22.479999999999961, 24.639999999999986, 21.710000000000036, 21.710000000000036, 23.265000000000043, 23.265000000000043, 18.965000000000032, 6.3199999999999932, 13.170000000000016, 11.824999999999989, 14.899999999999977, 14.899999999999977, 14.939999999999998, 19.650000000000034, 23.074999999999989, 22.970000000000027, 15.454999999999984, 15.454999999999984]

        self.kijunsen_default_expected = [np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, 26.779999999999973, 26.779999999999973, 26.779999999999973, 26.779999999999973, 26.779999999999973, 26.779999999999973, 26.779999999999973, 32.33499999999998, 32.33499999999998, 32.33499999999998, 32.33499999999998, 32.33499999999998, 31.060000000000002, 29.379999999999995, 29.379999999999995, 29.379999999999995, 29.379999999999995, 29.379999999999995, 33.169999999999959, 33.169999999999959, 34.439999999999998, 37.664999999999964, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 31.995000000000005, 27.725000000000023, 27.319999999999993, 27.319999999999993, 27.319999999999993, 27.319999999999993, 26.774999999999977, 23.660000000000025, 17.680000000000007, 17.680000000000007, 17.680000000000007, 17.680000000000007, 17.680000000000007, 17.980000000000018, 20.175000000000011, 15.850000000000023, 15.850000000000023, 18.314999999999998, 16.384999999999991, 13.615000000000009, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 9.7699999999999818, 9.7699999999999818, 9.7699999999999818, 9.8600000000000136, 10.004999999999995, 10.004999999999995, 10.004999999999995, 10.004999999999995, 10.004999999999995, 9.3199999999999932, 9.3199999999999932, 9.3199999999999932, 9.3199999999999932, 21.324999999999989, 23.259999999999991, 25.420000000000016, 25.485000000000014, 25.485000000000014, 27.04000000000002, 27.04000000000002, 27.54000000000002, 27.644999999999982, 36.430000000000007, 36.430000000000007, 39.504999999999995, 39.504999999999995, 40.644999999999982, 45.355000000000018, 50.615000000000009, 50.615000000000009, 51.295000000000016, 51.019999999999982]

        self.chiku_span_expected = [779, 785, 784.8, 775.97, 786.16, 779.98, 775.16, 753.22, 771.75, 780.29, 805.59, 811.98, 802.03, 781.1, 782.19, 788.42, 805.48, 809.9, 819.56, 817.35, 822.1, 828.55, 835.74, 824.06, 821.63, 827.09, 821.49, 806.84, 804.6, 804.08, 811.77, 809.57, 814.17, 800.71, 803.08, 801.23, 802.79, 800.38, 804.06, 802.64, 810.06, 810.73, 802.65, 814.96, 815.95, 805.03, 799.78, 795.39, 797.97, 801.23, 790.46, 788.72, 798.82, 788.48, 802.84, 807.99, 808.02, 796.87, 791.4, 789.85, 791.92, 795.82, 793.22, 791.3, 793.6, 796.59, 796.95, 799.65, 802.75, 805.42, 801.19, 805.96, 807.05, 808.2, 808.49, 807.48, 805.23, 806.93, 797.25, 798.92, 800.12, 800.94, 791.34, 765.84, 761.97, 757.65, 757.52, 759.28, 754.41, 757.08, 753.41, 753.2, 735.63, 735.8, 729.48, 732.51, 727.2, 717.78, 707.26, 708.97, 704.89, 710.25]

        self.senkou_a_expected = [np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, 19.66749999999999, 19.66749999999999, 19.66749999999999, 19.66749999999999, 16.780000000000001, 16.757499999999993, 16.139999999999986, 24.402499999999975, 24.402499999999975, 24.402499999999975, 29.259999999999991, 30.857499999999987, 30.219999999999999, 29.379999999999995, 29.379999999999995, 29.379999999999995, 24.747500000000002, 22.612500000000011, 26.19999999999996, 26.19999999999996, 27.469999999999999, 30.694999999999965, 34.017499999999984, 32.460000000000008, 28.194999999999993, 27.090000000000003, 25.227499999999992, 27.85499999999999, 28.414999999999992, 28.544999999999987, 28.544999999999987, 26.382499999999993, 26.382499999999993, 22.592500000000001, 19.057500000000005, 17.024999999999977, 17.024999999999977, 17.107499999999987, 17.107499999999987, 16.83499999999998, 15.277500000000003, 11.427500000000009, 11.427500000000009, 12.485000000000014, 12.732500000000016, 12.732500000000016, 13.032500000000027, 15.22750000000002, 13.065000000000026, 13.065000000000026, 15.530000000000001, 15.0, 13.615000000000009, 11.004999999999995, 10.45750000000001, 11.745000000000005, 11.752499999999998, 11.752499999999998, 11.752499999999998, 11.752499999999998, 11.752499999999998, 11.752499999999998, 11.409999999999997, 11.409999999999997, 11.409999999999997, 8.6225000000000023, 8.6425000000000125, 9.3174999999999955, 9.7300000000000182, 10.397500000000008, 8.414999999999992, 8.5500000000000114, 8.2474999999999739, 7.8325000000000102, 7.8874999999999886, 7.2125000000000057, 6.8274999999999864, 6.8274999999999864, 7.8125, 7.4699999999999989, 7.4699999999999989, 7.4699999999999989, 8.9474999999999909, 21.072499999999991, 22.869999999999976, 25.030000000000001, 23.597500000000025, 23.597500000000025, 25.152500000000032, 25.152500000000032, 23.252500000000026, 16.982499999999987, 24.800000000000011, 24.127499999999998, 27.202499999999986, 27.202499999999986, 27.79249999999999, 32.502500000000026, 36.844999999999999, 36.792500000000018, 33.375, 33.237499999999983]

        self.senkou_b_expected = [np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 41.259999999999991, 31.995000000000005, 27.725000000000023, 27.319999999999993, 27.319999999999993, 27.319999999999993, 27.319999999999993, 26.774999999999977, 23.660000000000025, 23.629999999999995, 23.629999999999995, 23.629999999999995, 23.629999999999995, 23.629999999999995, 23.629999999999995, 23.629999999999995, 19.305000000000007, 19.305000000000007, 19.305000000000007, 16.504999999999995, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 13.735000000000014, 25.055000000000007, 26.990000000000009, 29.150000000000034, 29.215000000000032, 29.215000000000032, 30.770000000000039, 30.770000000000039, 31.270000000000039, 31.375, 40.160000000000025, 40.160000000000025, 43.235000000000014, 43.235000000000014, 40.644999999999982, 45.355000000000018, 50.615000000000009, 50.615000000000009, 51.800000000000011, 51.800000000000011]

    def test_tenkansen_default_period(self):
        ts = ichimoku_cloud.tenkansen(self.close_data)
        np.testing.assert_array_equal(ts, self.tenkansen_default_expected)

    def test_kijunsen_default_period(self):
        ks = ichimoku_cloud.kijunsen(self.close_data)
        np.testing.assert_array_equal(ks, self.kijunsen_default_expected)

    def test_chiku_span(self):
        cs = ichimoku_cloud.chiku_span(self.close_data)
        np.testing.assert_array_equal(cs, self.chiku_span_expected)

    def test_senkou_a(self):
        sa = ichimoku_cloud.senkou_a(self.close_data)
        np.testing.assert_array_equal(sa, self.senkou_a_expected)

    def test_senkou_b(self):
        sb = ichimoku_cloud.senkou_b(self.close_data)
        np.testing.assert_array_equal(sb, self.senkou_b_expected)
